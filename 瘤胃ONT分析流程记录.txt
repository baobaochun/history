#数据存放路径
/public/sequencing_data/Rumen_ONT

#数据拷贝，拷贝完成后先验证传输数据是否完整，检验每一个.md5文件
cd /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/raw_data/genome/Nanopore/L3N/20190925-NPL1199-P1-PAE01409/PAE01409/qc_report
md5sum -c 20190925-NPL1199-P1-PAE01409.md5.txt
cd /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/raw_data/genome/Nanopore/L3N/20191011-NPL1199-P1-PAE03846/PAE03846/qc_report
md5sum -c 20191011-NPL1199-P1-PAE03846.md5.txt
cd /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/raw_data/genome/Nanopore/L3N/20191011-NPL1199-P1-PAE04012/PAE04012/qc_report
md5sum -c 20191011-NPL1199-P1-PAE04012.md5.txt
cd /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/raw_data/genome/Nanopore/L3N/20191011-NPL1199-P1-PAE05326/PAE05326/qc_report
md5sum -c 20191011-NPL1199-P1-PAE05326.md5.txt
cd /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/raw_data/genome/NGS/L3N
md5sum -c md5.txt

#在新服务器上安装miniconda3
cd /public/home/lichunhui/software
wget -c https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
#激活conda环境
. /public/home/lichunhui/software/miniconda3/bin/activate
#关闭conda环境
conda deactivate
#在conda环境下激活metawrap环境
conda activate metawrap
#在conda环境下激活drep环境
conda activate drep
#在conda环境下激活eggnog环境
conda activate eggnog
#在conda环境下激活diamond环境
conda activate diamond
#在conda环境下激活kegg环境
conda activate kegg
#在conda环境下激活antismash环境
conda activate antismash

#使用quast对~200G的NGS和TGS组装数据和~45G的NGS和TGS组装数据进行评估
#200NGS
quast.py -o /public/home/lichunhui/project/rumen_ont/02_quast/NGS /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/downstream_analysis_result/03.Assembly/NGS/megahit.assembly.fasta
#200TGS
quast.py -o /public/home/lichunhui/project/rumen_ont/02_quast/TGS /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/downstream_analysis_result/03.Assembly/TGS/1.pre_assembly/assembly.fasta
#45NGS
quast.py -o /public/home/lichunhui/project/rumen_ont/02_quast/45G_NGS/ /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/Comparison/NGS_vs_TGS/02.Assembly/NGS/megahit.assembly.fasta
#45TGS
quast.py -o /public/home/lichunhui/project/rumen_ont/02_quast/45G_TGS/ /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/Comparison/NGS_vs_TGS/02.Assembly/TGS/1.pre_assembly/assembly.fasta
#45merge
quast.py -o /public/home/lichunhui/project/rumen_ont/02_quast/merge/ /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/Comparison/NGS_vs_TGS/02.Assembly/Merged/assembly.fasta

#使用prodigal对~45G和~200G的二代和三代数据进行基因预测

#使用kraken2对~45G和~200G的二代和三代组装结果进行分类注释

#使用cd-hit对预测的基因去冗余
cd /public/home/lichunhui/project/rumen_ont/04_prodigal/TGS
cd-hit-est -i prodigal_tgs.orf.fasta -o cdhit_tgs.orf.fasta -n 9 -g 1 -c 0.95 -G 0 -M 0 -d 0 -aS 0.9 -T 20

cd /public/home/lichunhui/project/rumen_ont/04_prodigal/NGS
cd-hit-est -i prodigal_ngs.orf.fasta -o cdhit_ngs.orf.fasta -n 9 -g 1 -c 0.95 -G 0 -M 0 -d 0 -aS 0.9 -T 20

cd /public/home/lichunhui/project/rumen_ont/04_prodigal/merge
cd-hit-est -i prodigal_merge.orf.fasta -o cdhit_merge.orf.fasta -n 9 -g 1 -c 0.95 -G 0 -M 0 -d 0 -aS 0.9 -T 20


#使用diamond在nr数据库中进行基因注释


#对diamond_cazy的注释结果进行处理
awk '{print $1,$3,$11,$2}' /public/home/lichunhui/project/rumen_ont/08_diamond_cazy/diamond_cazy_45tgs.orf.fasta.csv | sed 's/|/\t/g' | awk '{print $1,$5,$2,$3}' > /public/home/lichunhui/project/rumen_ont/08_diamond_cazy/diamond_cazy_45tgs.orf.fasta.txt
awk '{print $1,$3,$11,$2}' /public/home/lichunhui/project/rumen_ont/08_diamond_cazy/diamond_cazy_45ngs.orf.fasta.csv | sed 's/|/\t/g' | awk '{print $1,$5,$2,$3}' > /public/home/lichunhui/project/rumen_ont/08_diamond_cazy/diamond_cazy_45ngs.orf.fasta.txt
awk '{print $1,$3,$11,$2}' /public/home/lichunhui/project/rumen_ont/08_diamond_cazy/diamond_cazy_45merge.orf.fasta.csv | sed 's/|/\t/g' | awk '{print $1,$5,$2,$3}' > /public/home/lichunhui/project/rumen_ont/08_diamond_cazy/diamond_cazy_45merge.orf.fasta.txt
awk '{print $1,$3,$11,$2}' /public/home/lichunhui/project/rumen_ont/08_diamond_cazy/diamond_cazy_200ngs.orf.fasta.csv | sed 's/|/\t/g' | awk '{print $1,$5,$2,$3}' > /public/home/lichunhui/project/rumen_ont/08_diamond_cazy/diamond_cazy_200ngs.orf.fasta.txt
awk '{print $1,$3,$11,$2}' /public/home/lichunhui/project/rumen_ont/08_diamond_cazy/diamond_cazy_200tgs.orf.fasta.csv | sed 's/|/\t/g' | awk '{print $1,$5,$2,$3}' > /public/home/lichunhui/project/rumen_ont/08_diamond_cazy/diamond_cazy_200tgs.orf.fasta.txt

#在eggnog数据库中进行注释

#kegg注释
exec_annotation -o /public/home/lichunhui/project/rumen_ont/11_kegg/prodigal_45tgs.orf.faa.txt -p /public/home/lichunhui/database/kofamscan/profiles -k /public/home/lichunhui/database/kofamscan/ko_list --cpu 5 -E 1e-5 /public/home/lichunhui/project/rumen_ont/04_prodigal/45G_TGS/prodigal_45tgs.orf.faa

#本地blastn
/public/home/lichunhui/software/ncbi-blast-2.10.1+/bin/blastn -query /public/home/lichunhui/project/rumen_ont/07_binstat/200tgs/200tgs_HQ_bin/tgs_bin.1443.fa -db /public/home/lichunhui/database/NCBI/nt_blastdb -out /public/home/lichunhui/project/rumen_ont/10_bin_compare/tgs_bin.1443.fa.blastn -task blastn -outfmt "7 qseqid sseqid evalue bitscore" -evalue 1e-18 -max_target_seqs 5 -num_threads 20
/public/home/lichunhui/software/ncbi-blast-2.10.1+/bin/blastn -query /public/home/lichunhui/project/rumen_ont/07_binstat/200tgs/200tgs_HQ_bin/tgs_bin.3775.fa -db /public/home/lichunhui/database/NCBI/nt_blastdb -out /public/home/lichunhui/project/rumen_ont/10_bin_compare/tgs_bin.3775.fa.blastn -task blastn -outfmt "7 qseqid sseqid evalue bitscore" -evalue 1e-18 -max_target_seqs 5 -num_threads 20
/public/home/lichunhui/software/ncbi-blast-2.10.1+/bin/blastn -query /public/home/lichunhui/project/rumen_ont/07_binstat/200ngs/200ngs_MQ_bin/ngs_bin.564.fa -db /public/home/lichunhui/database/NCBI/nt_blastdb -out /public/home/lichunhui/project/rumen_ont/10_bin_compare/ngs_bin.564.fa.blastn -task blastn -outfmt "7 qseqid sseqid evalue bitscore" -evalue 1e-18 -max_target_seqs 5 -num_threads 20
/public/home/lichunhui/software/ncbi-blast-2.10.1+/bin/blastn -query /public/home/lichunhui/project/rumen_ont/07_binstat/200ngs/200ngs_MQ_bin/ngs_bin.720.fa -db /public/home/lichunhui/database/NCBI/nt_blastdb -out /public/home/lichunhui/project/rumen_ont/10_bin_compare/ngs_bin.720.fa.blastn -task blastn -outfmt "7 qseqid sseqid evalue bitscore" -evalue 1e-18 -max_target_seqs 5 -num_threads 20


#使用mummer获得序列比对上参考基因组的位置信息
nucmer /public/home/lichunhui/project/rumen_ont/10_bin_compare/CP011391.1.fasta /public/home/lichunhui/project/rumen_ont/10_bin_compare/tgs_bin.1443.fa
nucmer /public/home/lichunhui/project/rumen_ont/10_bin_compare/CP011391.1.fasta /public/home/lichunhui/project/rumen_ont/07_binstat/200G_MQbin/ngs_bin.564.fa
show-coords -r tgs_bin_1443.delta > tgs_bin_1443.coords
grep -E 'tig' tgs_bin_1443.coords | awk '{print $1,$2}' | sed 's/\ /\t/g' > SRR8427256_startend.txt


#预测16S-rRNA
barrnap --threads 20 < /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/Comparison/NGS_vs_TGS/02.Assembly/TGS/1.pre_assembly/assembly.fasta > barrnap_45tgs_contigs.rRNA.gff
barrnap --threads 20 < /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/Comparison/NGS_vs_TGS/02.Assembly/NGS/megahit.assembly.fasta > barrnap_45ngs_contigs.rRNA.gff
barrnap --threads 20 < /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/Comparison/NGS_vs_TGS/02.Assembly/Merged/assembly.fasta > barrnap_45merge_contigs.rRNA.gff
barrnap --threads 20 < /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/downstream_analysis_result/03.Assembly/TGS/1.pre_assembly/assembly.fasta > barrnap_200tgs_contigs.rRNA.gff
barrnap --threads 20 < /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/downstream_analysis_result/03.Assembly/NGS/megahit.assembly.fasta > barrnap_200ngs_contigs.rRNA.gff



awk '/^>/&&NR>1{print "";}{ printf "%s",/^>/ ? $0" ":$0 }' /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/Comparison/NGS_vs_TGS/02.Assembly/TGS/1.pre_assembly/assembly.fasta | awk '{print $1"\t"length($2)}' > test.txt

awk '/^>/&&NR>1{print "";}{ printf "%s",/^>/ ? $0" ":$0 }' /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/Comparison/NGS_vs_TGS/02.Assembly/NGS/megahit.assembly.fasta | awk '{print $1"\t"length($5)}' > contig_len_45ngs.txt

awk '/^>/&&NR>1{print "";}{ printf "%s",/^>/ ? $0" ":$0 }' /public/sequencing_data/Rumen_ONT/WHWLZ-201911127D-01/result/Comparison/NGS_vs_TGS/02.Assembly/Merged/assembly.fasta | awk '{print $1"\t"length($2)}' > contig_len_45merge.txt

awk '/^>/&&NR>1{print "";}{ printf "%s",/^>/ ? $0" ":$0 }' /public/home/lichunhui/project/rumen_ont/04_prodigal/45G_TGS/prodigal_45tgs.orf.fasta | awk '{print $1"\t"length($10)}' > orf_len_45tgs.txt
awk '/^>/&&NR>1{print "";}{ printf "%s",/^>/ ? $0" ":$0 }' /public/home/lichunhui/project/rumen_ont/04_prodigal/45G_NGS/prodigal_45ngs.orf.fasta | awk '{print $1"\t"length($10)}' > orf_len_45ngs.txt
awk '/^>/&&NR>1{print "";}{ printf "%s",/^>/ ? $0" ":$0 }' /public/home/lichunhui/project/rumen_ont/04_prodigal/45G_merge/prodigal_45merge.orf.fasta | awk '{print $1"\t"length($10)}' > orf_len_45merge.txt
awk '/^>/&&NR>1{print "";}{ printf "%s",/^>/ ? $0" ":$0 }' /public/home/lichunhui/project/rumen_ont/04_prodigal/200G_NGS/prodigal_200ngs.orf.fasta | awk '{print $1"\t"length($10)}' > orf_len_200ngs.txt
awk '/^>/&&NR>1{print "";}{ printf "%s",/^>/ ? $0" ":$0 }' /public/home/lichunhui/project/rumen_ont/04_prodigal/200G_TGS/prodigal_200tgs.orf.fasta | awk '{print $1"\t"length($10)}' > orf_len_200tgs.txt
awk '/^>/&&NR>1{print "";}{ printf "%s",/^>/ ? $0" ":$0 }' /public/home/lichunhui/project/rumen_ont/04_prodigal/45G_TGS/prodigal_tgs_polish.orf.fasta | awk '{print $1"\t"length($10)}' > orf_len_45tgs_polish.txt
awk '/^>/&&NR>1{print "";}{ printf "%s",/^>/ ? $0" ":$0 }' /public/home/lichunhui/project/rumen_ont/04_prodigal/200G_TGS/prodigal_200tgs_polish.orf.fasta | awk '{print $1"\t"length($10)}' > orf_len_200tgs_polish.txt



grep -E '16S' barrnap_45ngs_contigs.rRNA.gff | awk '{print $1}' | sort | uniq -d | less
grep -E '16S' barrnap_45tgs_contigs.rRNA.gff | awk '{print $1}' | sort | uniq -d | wc -l 
grep -E '16S' barrnap_45merge_contigs.rRNA.gff | awk '{print $1}' | sort | uniq -d | wc -l 
grep -E '16S' barrnap_200tgs_contigs.rRNA.gff | awk '{print $1}' | sort | uniq -d | wc -l 
grep -E '16S' barrnap_200ngs_contigs.rRNA.gff | awk '{print $1}' | sort | uniq -d | wc -l 

#计算平均ORF长度
cat /public/home/lichunhui/project/rumen_ont/14_len_stat/orf_len_200tgs_polish.txt | awk '{sum+=$2} END {print "avg_len=",sum/NR}'